#### SELinux: проблема с удаленным обновлением зоны DNS

Инженер настроил следующую схему:

- ns01 - DNS-сервер (192.168.50.10);
- client - клиентская рабочая станция (192.168.50.15).

При попытке удаленно (с рабочей станции) внести изменения в зону ddns.lab происходит следующее:
```bash
[vagrant@client ~]$ nsupdate -k /etc/named.zonetransfer.key
> server 192.168.50.10
> zone ddns.lab
> update add www.ddns.lab. 60 A 192.168.50.15
> send
update failed: SERVFAIL
>
```
Инженер перепроверил содержимое конфигурационных файлов и, убедившись, что с ними всё в порядке, предположил, что данная ошибка связана с SELinux.

В данной работе предлагается разобраться с возникшей ситуацией.


#### Задание

- Выяснить причину неработоспособности механизма обновления зоны.
- Предложить решение (или решения) для данной проблемы.
- Выбрать одно из решений для реализации, предварительно обосновав выбор.
- Реализовать выбранное решение и продемонстрировать его работоспособность.


#### Формат

- README с анализом причины неработоспособности, возможными способами решения и обоснованием выбора одного из них.
- Исправленный стенд или демонстрация работоспособной системы скриншотами и описанием.


## Решение проблемы.

#### Причина неработоспособности механизма обновления зоны:
BIND хранит информацию в текстовых файлах (журналах) зон. Чтобы создать DNS запись, BIND должен создать файл. Из логов named видна попытка создать файл /etc/named/dynamic/named.ddns.lab.view1.jnl. Но для selinux домена named_t создание файлов в папке /etc не разрешено. Поэтому создать DNS запись не удается.

#### Способы решения:
Т.к. разрешать запись фалов в /etc небезопасно и selinux file_contexts для named в основном сконфигурированы для запуска named под chroot. Посмотреть можно командой:
```
cat /etc/selinux/targeted/active/file_contexts | grep named
```
Необходимо запустить named под chroot, кроме формирования chroot окружения, нужно разрешить named записывать мастер зоны:
```
setsebool -P named_write_master_zones 1
```

#### Проверка:
```
[vagrant@client ~]$ nsupdate -k /etc/named.zonetransfer.key
> server 192.168.50.10
> zone ddns.lab
> update add www.ddns.lab. 60 A 192.168.50.15
> send
>
> quit
[vagrant@client ~]$
```
